{
  "schema": "chronicle/knowledge-v1",
  "conventions": [
    {
      "id": "conv-1",
      "scope": "src/web/",
      "rule": "Any endpoint returning file paths from annotations must filter against files at HEAD (via list_files) to exclude references to deleted files. Wisdom entries and diff-tree results both need this filter.",
      "stability": "permanent"
    },
    {
      "id": "conv-2",
      "scope": "src/web/",
      "rule": "Annotations from --auto and --summary modes have empty wisdom arrays with no file references. Endpoints that derive file lists from annotations must fall back to git diff-tree --name-only to get the commit's changed files.",
      "stability": "permanent"
    },
    {
      "id": "conv-3",
      "scope": "src/schema/",
      "rule": "parse_annotation() migrates all annotations to v3, losing the original schema version. Use schema::peek_version() to extract the original version string from raw JSON when the original version matters (e.g. display, diagnostics).",
      "stability": "permanent"
    }
  ],
  "boundaries": [],
  "anti_patterns": [
    {
      "id": "ap-4",
      "pattern": "Using CSS line-clamp-N to constrain height of text that may contain newlines",
      "instead": "Truncate the text in JS (collapse newlines, cap length) before rendering. CSS line-clamp visually truncates but does not constrain element height when content has embedded newlines."
    }
  ]
}
